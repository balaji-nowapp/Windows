using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace Pidilite
{
    public static class StoreProcedure
    {
        public static string str = "IF EXISTS(SELECT* FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[usp_GetMenubyParent]') AND type in (N'P', N'PC')) \n  DROP PROCEDURE[dbo].[usp_GetMenubyParent] \n   \n \n CREATE procedure[dbo].[usp_GetMenubyParent] \n  ( \n   @parentId smallint \n    ) \n   as  \n  begin \n   if exists(Select* from tb_menu with(nolock) where parent_id = @parentId ) \n begin \n --if (@parentId =0) \n --begin \n select menu_id as id, menu_name as name, menu_icons as loClass, menu_icons_code as lo, menu_bg_color as backgroundColor, parent_id as parentId, module as moduleName, menu_module_id as moduleId, position as position, ordering as ordering from tb_menu with  (nolock) where parent_id = @ParentId and position ='sidebar' order by ordering asc \n  -- end \n  --else \n --begin \n  --    select menu_id as id, menu_name as name, menu_icons as loClass, menu_icons_code as lo, menu_bg_color as backgroundColor, parent_id as parentId, module as moduleName, menu_module_id as moduleId, position as position, ordering as ordering from tb_menu with(nolock) where menu_id = @ParentId and position ='sidebar'  -- end \n end \n  end \n    \n IF  EXISTS (SELECT* FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[usp_InsertMenu]') AND type in (N'P', N'PC')) \n DROP PROCEDURE[dbo].[usp_InsertMenu] \n  \ncreate Procedure [dbo].[usp_InsertMenu] \n ( \n @id int,\n @name varchar(max),\n @loClass varchar(max),\n @lo varchar(max),\n @backgroundColor varchar(max),\n @parentId int, \n @moduleName varchar(max),\n @moduleId int,\n @position varchar(max),\n @ordering int , \n @OpCode smallint output \n ) \n as \n begin \n SET IDENTITY_INSERT tb_menu ON \n if not exists(Select menu_id from tb_menu with(nolock) where menu_id = @id) \n begin \n Insert into tb_menu (menu_id, menu_name, menu_icons, menu_icons_code, menu_bg_color, parent_id, module, menu_module_id, position, ordering, entry_by, owned_by, created_by ) values (@id, @name, @loClass, @lo, @backgroundColor, @parentId, @moduleName, @moduleId, @position, @ordering,0,0,0) \n  set @OpCode = 1 \n  end \n  else \n  begin \n  set @OpCode =-1 \n end \n SET IDENTITY_INSERT tb_menu OFF \n end \n  \n \n IF  EXISTS (SELECT* FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[usp_LoginCheck]') AND type in (N'P', N'PC'))\n DROP PROCEDURE[dbo].[usp_LoginCheck]\n  \n create procedure[dbo].[usp_LoginCheck] \n  ( \n @UserName varchar(max), \n  Password varchar(max),\n  @OpCode bigint output \n  ) \n  as \n begin \n Declare @Action smallint \n  if exists(select id from tb_users with(nolock) where username =@UserName and password = @Password) \n  begin \n   set @OpCode = (select id from tb_users with(nolock) where username =@UserName and password = @Password)-- Valid User \n   set @Action = (select active from tb_users with(nolock) where username =@UserName and password = @Password) \n if (@Action =0) \n begin \n  set @OpCode = -1 -- Inactive user \n end \n else if  (@Action =2) \n begin \n set @OpCode = -2 -- Blocked User \n end \n end \n else \n begin \n set @OpCode = -3-- Incorrect Credentials \n end\nend \n \n \n IF  EXISTS (SELECT* FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ufn_GetParentIdsofMenu]') AND type in (N'FN', N'IF', N'TF', N'FS', N'FT'))\n DROP FUNCTION[dbo].[ufn_GetParentIdsofMenu]\n \n\n CREATE function[dbo].[ufn_GetParentIdsofMenu]\n ()\nreturns nvarchar(max)\n as \n  begin \n Declare @Return nvarchar(max)\n set @Return = (Select Distinct Stuff(\n (Select ',' + cast(menu_id as nvarchar(max)) From tb_menu q1 where q1.parent_id = 0 and q1.position = 'sidebar' Order By  q1.ordering asc For XML Path(''),Type).value('text()[1]','varchar(max)'),1,1,''))\n return  @Return \n end \n  \n IF NOT EXISTS(SELECT 1 FROM sys.columns WHERE Name = N'user_photo' AND Object_ID = Object_ID(N'dbo.tb_users'))\n BEGIN \n ALTER TABLE tb_users ADD user_photo varbinary(max) null \n END\n\n\nIF EXISTS(SELECT* FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[usp_GetUserDetail]') AND type in (N'P', N'PC'))\n DROP PROCEDURE[dbo].[usp_GetUserDetail] \n \n  \n \n create proc[dbo].[usp_GetUserDetail] \n ( \n @UserId bigint \n ) \n as \n begin \n select a.first_name as FirstName, a.last_name , a.user_photo from tb_users a with(nolock) where id=  @UserId\nend\n";
    }
}